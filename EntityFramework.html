<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Entity Framework Cheat Sheet</title>
    <link rel="stylesheet" href="stylesheet.css">
</head>
<body style="display: flex; flex-direction: column;">

<!-- Navigation -->
<div class="nav">
    <a class="nav_element" href="index.html">C#</a>
    <a class="nav_element" href="EntityFramework.html" style="font-weight: bold;">Entity Framework</a>
    <a class="nav_element" href="Blazor.html">Blazor</a>
    <a class="nav_element" href="SQL.html">SQL</a>
    <a class="nav_element" href="Recursion.html">Recursion</a>
</div>

<!-- Header -->
<div class="content_box">
    <h1>Entity Framework Core – dev-docs</h1>
    <p>Example: Blog system with <code>Post</code> entity, service layer, seeding, many-to-many tagging, and database view.</p>
    <p>
        <a href="https://learn.microsoft.com/en-us/ef/core/" target="_blank">
            → Official Entity Framework Core Documentation
        </a>
    </p>
</div>

<!-- Model Example -->
<div class="content_box" style="margin-top: 3em;">
    <h2>Post + Tag + PostTag (Many-to-Many)</h2>
    <p>Post and Tag entities joined with PostTag, using a defined key and DeleteBehavior.Restrict.</p>
    <pre><code>public class Post
{
    [Key]
    public int Id { get; set; }

    [Required]
    [MaxLength(200)]
    public string Title { get; set; } = string.Empty;

    [Required]
    public string Content { get; set; } = string.Empty;

    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

    public ICollection<PostTag> PostTags { get; set; } = new List<PostTag>();
}

public class Tag
{
    [Key]
    public int Id { get; set; }

    [Required]
    public string Name { get; set; } = string.Empty;

    public ICollection<PostTag> PostTags { get; set; } = new List<PostTag>();
}

public class PostTag
{
    [Key]
    public int Id { get; set; }

    public int PostId { get; set; }
    public Post Post { get; set; } = null!;

    public int TagId { get; set; }
    public Tag Tag { get; set; } = null!;
}</code></pre>
</div>

<!-- DbContext -->
<div class="content_box">
    <h3>ApplicationDbContext with Seeder and View</h3>
    <pre><code>public class ApplicationDbContext : DbContext
{
    public DbSet<Post> Posts { get; set; }
    public DbSet<Tag> Tags { get; set; }
    public DbSet<PostTag> PostTags { get; set; }
    public DbSet<PostStatsView> PostStatsViews { get; set; }

    public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options) : base(options) {}

    protected override void OnModelCreating(ModelBuilder builder)
    {
        base.OnModelCreating(builder);

        builder.Entity<Post>().HasData(
            new Post { Id = 1, Title = "Hello World", Content = "This is my first post!", CreatedAt = DateTime.UtcNow }
        );

        builder.Entity<Tag>().HasData(
            new Tag { Id = 1, Name = "C#" },
            new Tag { Id = 2, Name = "EF Core" }
        );

        builder.Entity<PostStatsView>()
               .HasNoKey()
               .ToView("PostStats");

        builder.Entity<PostTag>()
            .HasOne(pt => pt.Post)
            .WithMany(p => p.PostTags)
            .HasForeignKey(pt => pt.PostId)
            .OnDelete(DeleteBehavior.Restrict);

        builder.Entity<PostTag>()
            .HasOne(pt => pt.Tag)
            .WithMany(t => t.PostTags)
            .HasForeignKey(pt => pt.TagId)
            .OnDelete(DeleteBehavior.Restrict);
    }
}</code></pre>
</div>

<!-- View Model -->
<div class="content_box">
    <h3>PostStatsView – Database View</h3>
    <pre><code>public class PostStatsView
{
    public int TotalPosts { get; set; }
    public DateTime LatestPost { get; set; }
}</code></pre>
</div>

<!-- Program.cs -->
<div class="content_box">
    <h3>Program.cs – Register Context & Service</h3>
    <pre><code>builder.Services.AddDbContext&lt;ApplicationDbContext&gt;(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));
</code></pre>
</div>

<!-- Footer -->
<footer style="margin-top: 5em; padding: 1em; text-align: center; font-size: 0.9em; color: #666;">
    <p>This material is intended for learning purposes only and may contain inaccuracies or omissions.</p>
</footer>

</body>
</html>
